id: prep_tasks
resources:
    - id: sources{{index}}
      from: resources/sources
      location: {{node}}
      values:
        sources:
            - src: /var/lib/fuel/keys/{{env}}/neutron
              dst: /var/lib/astute
            - src: /var/lib/fuel/keys/{{env}}/nova
              dst: /var/lib/astute
            - src: /var/lib/fuel/keys/{{env}}/mysql
              dst: /var/lib/astute
            - src: /var/lib/fuel/keys/{{env}}/mongo
              dst: /var/lib/astute
            - src: /etc/puppet/modules
              dst: /etc/puppet/
    - id: mos_repos{{index}}
      from: templates/mos_repos.yaml
      values:
        node: {{node}}
        index: {{index}}
events:
    - type: depends_on
      state: success
      parent:
        action: run
        with_tags:
            - resource=genkeys
      depend_action: sources{{index}}.run
    - type: depends_on
      state: success
      parent_action: sources{{index}}.run
      depend_action: role_data{{index}}.run
    - type: depends_on
      state: success
      parent_action: managed_apt_{{index}}.run
      depend_action: role_data{{index}}.run
